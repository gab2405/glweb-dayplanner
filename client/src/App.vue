<template>
  <div id="app" class="wrapper">
    <header>
      <div class="container">
        <nav>
          <router-link to="/" exact>
            <svg
              id="Calendar"
              xmlns="http://www.w3.org/2000/svg"
              x="0px"
              y="0px"
              width="50"
              height="50"
              viewBox="0 0 172 172"
              style=" fill:#000000;"
            >
              <g
                fill="none"
                fill-rule="nonzero"
                stroke="none"
                stroke-width="1"
                stroke-linecap="butt"
                stroke-linejoin="miter"
                stroke-miterlimit="10"
                stroke-dasharray
                stroke-dashoffset="0"
                font-family="none"
                font-weight="none"
                font-size="none"
                text-anchor="none"
                style="mix-blend-mode: normal"
              >
                <path d="M0,172v-172h172v172z" fill="none" />
                <g fill="#000000">
                  <path
                    d="M41.28,0c-3.7625,0 -6.88,3.1175 -6.88,6.88v6.88h-20.64c-1.80062,0 -3.62812,0.65844 -4.91812,1.96188c-1.30344,1.29 -1.96188,3.1175 -1.96188,4.91812v137.6c0,1.80063 0.65844,3.62813 1.96188,4.93156c1.29,1.29 3.1175,1.94844 4.91812,1.94844h144.48c1.80063,0 3.62813,-0.65844 4.93156,-1.94844c1.29,-1.30344 1.94844,-3.13094 1.94844,-4.93156v-137.6c0,-1.80062 -0.65844,-3.62812 -1.94844,-4.91812c-1.30344,-1.30344 -3.13094,-1.96188 -4.93156,-1.96188h-20.64v-6.88c0,-3.7625 -3.1175,-6.88 -6.88,-6.88h-6.88c-3.7625,0 -6.88,3.1175 -6.88,6.88v6.88h-61.92v-6.88c0,-3.7625 -3.1175,-6.88 -6.88,-6.88zM41.28,6.88h6.88v20.64h-6.88zM123.84,6.88h6.88v20.64h-6.88zM13.76,20.64h20.64v6.88c0,3.7625 3.1175,6.88 6.88,6.88h6.88c3.7625,0 6.88,-3.1175 6.88,-6.88v-6.88h61.92v6.88c0,3.7625 3.1175,6.88 6.88,6.88h6.88c3.7625,0 6.88,-3.1175 6.88,-6.88v-6.88h20.64v24.08h-144.48zM13.76,51.6h144.48v106.64h-144.48zM34.4,65.36v79.12h103.2v-79.12zM41.28,72.24h17.2v17.2h-17.2zM65.36,72.24h17.2v17.2h-17.2zM89.44,72.24h17.2v17.2h-17.2zM113.52,72.24h17.2v17.2h-17.2zM41.28,96.32h17.2v17.2h-17.2zM65.36,96.32h17.2v17.2h-17.2zM89.44,96.32h17.2v17.2h-17.2zM113.52,96.32h17.2v17.2h-17.2zM41.28,120.4h17.2v17.2h-17.2zM65.36,120.4h17.2v17.2h-17.2zM89.44,120.4h17.2v17.2h-17.2zM113.52,120.4h17.2v17.2h-17.2z"
                  />
                </g>
              </g>
            </svg>
          </router-link>
          <router-link to="/tasks">
            <svg
              id="Tasks"
              xmlns="http://www.w3.org/2000/svg"
              x="0px"
              y="0px"
              width="50"
              height="50"
              viewBox="0 0 172 172"
              style=" fill:#000000;"
            >
              <g
                fill="none"
                fill-rule="nonzero"
                stroke="none"
                stroke-width="1"
                stroke-linecap="butt"
                stroke-linejoin="miter"
                stroke-miterlimit="10"
                stroke-dasharray
                stroke-dashoffset="0"
                font-family="none"
                font-weight="none"
                font-size="none"
                text-anchor="none"
                style="mix-blend-mode: normal"
              >
                <path d="M0,172v-172h172v172z" fill="none" />
                <g fill="#000000">
                  <path
                    d="M65.36,3.44c-1.79644,0 -3.62786,0.65817 -4.92485,1.95516c-1.29698,1.29698 -1.95515,3.1284 -1.95515,4.92484h-27.52c-5.68976,0 -10.32,4.63024 -10.32,10.32v130.72c0,5.68976 4.63024,10.32 10.32,10.32h110.08c4.77472,0 8.80431,-3.25602 9.97735,-7.6661c0.2236,-0.84624 0.34265,-1.73886 0.34265,-2.6539v-130.72c0,-5.68976 -4.63024,-10.32 -10.32,-10.32h-27.52c0,-1.79644 -0.65817,-3.62786 -1.95515,-4.92484c-1.29699,-1.29698 -3.1284,-1.95516 -4.92485,-1.95516zM65.36,10.32h41.28v20.64h-41.28zM30.96,17.2h27.52v6.88h-24.08v123.84h103.2v-123.84h-24.08v-6.88h27.52c1.89544,0 3.44,1.54112 3.44,3.44v130.72c0,1.89888 -1.54456,3.44 -3.44,3.44h-110.08c-1.89544,0 -3.44,-1.54112 -3.44,-3.44v-130.72c0,-1.89888 1.54456,-3.44 3.44,-3.44zM41.28,30.96h17.2c0,1.79644 0.65817,3.62786 1.95515,4.92485c1.29699,1.29698 3.1284,1.95515 4.92485,1.95515h41.28c1.79644,0 3.62786,-0.65817 4.92485,-1.95515c1.29698,-1.29699 1.95515,-3.1284 1.95515,-4.92485h17.2v110.08h-89.44zM106.35781,58.48672c-0.97137,0.03053 -1.93667,0.19775 -2.86891,0.50391c-1.36555,0.4457 -2.64003,1.21568 -3.75578,2.25078l-0.02688,-0.02687l-0.01344,-0.02016l-40.09078,40.09078c-0.42656,0.42656 -0.73536,0.9538 -0.8936,1.5386l-3.55422,13.24265c-0.31992,1.1868 0.02328,2.45546 0.8936,3.32578c0.6536,0.6536 1.53091,1.00781 2.43219,1.00781c0.29928,0 0.6012,-0.0351 0.8936,-0.11422l13.24265,-3.55422c0.5848,-0.15824 1.11204,-0.46704 1.5386,-0.8936l40.09078,-40.09078l-0.02016,-0.01344l-0.02015,-0.02015c1.20345,-1.29783 2.02889,-2.81993 2.4389,-4.43438c0.516,-2.03648 0.40055,-4.19653 -0.34937,-6.17453c-0.4988,-1.31752 -1.27861,-2.55844 -2.33813,-3.6214c-1.34848,-1.34848 -2.98312,-2.24046 -4.70312,-2.68078c-0.94772,-0.24252 -1.92441,-0.34631 -2.89578,-0.31578zM102.53485,68.0811l4.82406,4.82406l-37.41672,37.41672l-6.59781,1.77375l1.77375,-6.59781z"
                  />
                </g>
              </g>
            </svg>
          </router-link>
          <router-link to="/stats">
            <svg
              id="Stats"
              xmlns="http://www.w3.org/2000/svg"
              x="0px"
              y="0px"
              width="50"
              height="50"
              viewBox="0 0 172 172"
              style=" fill:#000000;"
            >
              <g
                fill="none"
                fill-rule="nonzero"
                stroke="none"
                stroke-width="1"
                stroke-linecap="butt"
                stroke-linejoin="miter"
                stroke-miterlimit="10"
                stroke-dasharray
                stroke-dashoffset="0"
                font-family="none"
                font-weight="none"
                font-size="none"
                text-anchor="none"
                style="mix-blend-mode: normal"
              >
                <path d="M0,172v-172h172v172z" fill="none" />
                <g fill="#000000">
                  <path
                    d="M85.6775,-0.1075c-0.14781,0.02687 -0.29562,0.06719 -0.43,0.1075c-1.59906,0.36281 -2.72781,1.80063 -2.6875,3.44v10.32h-82.56v116.96h82.56v5.375l-29.9925,29.9925c-1.37062,1.37063 -1.37062,3.57438 0,4.945c1.37063,1.37063 3.57438,1.37063 4.945,0l25.0475,-25.0475v8.815c-0.01344,1.23625 0.63156,2.39188 1.70656,3.02344c1.075,0.61813 2.39187,0.61813 3.46687,0c1.075,-0.63156 1.72,-1.78719 1.70656,-3.02344v-8.815l25.0475,25.0475c1.37063,1.37063 3.57438,1.37063 4.945,0c1.37063,-1.37062 1.37063,-3.57437 0,-4.945l-29.9925,-29.885v-5.4825h82.56v-116.96h-82.56v-10.32c0.04031,-0.99437 -0.36281,-1.94844 -1.075,-2.62031c-0.72562,-0.68531 -1.70656,-1.02125 -2.6875,-0.92719zM6.88,20.64h158.24v103.2h-78.475c-0.45687,-0.09406 -0.94062,-0.09406 -1.3975,0h-78.3675zM141.04,48.16c-3.80281,0 -6.88,3.07719 -6.88,6.88c0,0.29563 0.06719,0.57781 0.1075,0.86l-35.26,27.1975c-0.81969,-0.34937 -1.73344,-0.5375 -2.6875,-0.5375c-0.95406,0 -1.86781,0.18813 -2.6875,0.5375h-0.1075l-28.165,-20.5325c0.01344,-0.215 0,-0.43 0,-0.645c0,-3.80281 -3.07719,-6.88 -6.88,-6.88c-3.80281,0 -6.88,3.07719 -6.88,6.88c0,0.25531 0.08063,0.49719 0.1075,0.7525l-18.06,13.545c-0.81969,-0.34937 -1.73344,-0.5375 -2.6875,-0.5375c-3.80281,0 -6.88,3.07719 -6.88,6.88c0,3.80281 3.07719,6.88 6.88,6.88c3.80281,0 6.88,-3.07719 6.88,-6.88c0,-0.25531 -0.08062,-0.49719 -0.1075,-0.7525l18.06,-13.545c0.81969,0.34938 1.73344,0.5375 2.6875,0.5375c0.95406,0 1.86781,-0.18812 2.6875,-0.5375h0.1075l28.165,20.5325c-0.01344,0.215 0,0.43 0,0.645c0,3.80281 3.07719,6.88 6.88,6.88c3.80281,0 6.88,-3.07719 6.88,-6.88c0,-0.29562 -0.06719,-0.57781 -0.1075,-0.86l35.26,-27.1975h0.1075c0.79281,0.3225 1.66625,0.5375 2.58,0.5375c3.80281,0 6.88,-3.07719 6.88,-6.88c0,-3.80281 -3.07719,-6.88 -6.88,-6.88z"
                  />
                </g>
              </g>
            </svg>
          </router-link>
          <Accordion class="auth-links">
            <template v-slot:button>
              <router-link to="/dashboard" :event="disabled ? '' : 'click'">
                <svg
                  id="Profile"
                  xmlns="http://www.w3.org/2000/svg"
                  x="0px"
                  y="0px"
                  width="50"
                  height="50"
                  viewBox="0 0 226 226"
                  style=" fill:#000000;"
                >
                  <g
                    fill="none"
                    fill-rule="nonzero"
                    stroke="none"
                    stroke-width="1"
                    stroke-linecap="butt"
                    stroke-linejoin="miter"
                    stroke-miterlimit="10"
                    stroke-dasharray
                    stroke-dashoffset="0"
                    font-family="none"
                    font-weight="none"
                    font-size="none"
                    text-anchor="none"
                    style="mix-blend-mode: normal"
                  >
                    <path d="M0,226v-226h226v226z" fill="none" />
                    <g fill="#000000">
                      <path
                        d="M40.68,18.08c-12.40945,0 -22.6,10.19055 -22.6,22.6v144.64c0,12.40946 10.19055,22.6 22.6,22.6h144.64c12.40946,0 22.6,-10.19054 22.6,-22.6v-144.64c0,-12.40945 -10.19054,-22.6 -22.6,-22.6zM40.68,27.12h144.64c7.47854,0 13.56,6.08145 13.56,13.56v144.64c0,6.12141 -4.10435,11.24398 -9.68445,12.92437c-1.35193,-7.23004 -4.60716,-13.03036 -8.91641,-17.40906c-5.24521,-5.32974 -11.78381,-8.70911 -18.15062,-11.45891c-6.36682,-2.74979 -12.64051,-4.89695 -17.41789,-7.27437c-4.62883,-2.30349 -7.35525,-4.6795 -8.5368,-7.41563c-0.27875,-4.63733 -0.32234,-8.4579 -0.32664,-12.58008c1.81417,-1.8199 3.18983,-3.93721 4.52883,-6.68289c1.58902,-3.25839 2.65995,-7.22873 3.33703,-11.22055c3.52898,-1.99689 6.41007,-5.71825 7.09781,-12.55359l0.00883,-0.01766v-0.02649c0.36793,-4.02279 -0.87461,-6.82004 -2.46305,-9.01351c1.92173,-6.11485 4.19123,-15.64819 3.38117,-25.62805c-0.45014,-5.54564 -1.8738,-11.16293 -5.3057,-15.82883c-3.06829,-4.17136 -8.04572,-7.05365 -14.16914,-8.35141c-1.78578,-2.42826 -4.15506,-4.36224 -7.03602,-5.49992c-3.66802,-1.4485 -7.93763,-2.08344 -12.63305,-2.08344h-0.05297h-0.05297c-17.95874,0.43085 -29.64053,7.89631 -34.65039,19.21883c-4.73625,10.70413 -3.74132,23.90149 -0.44141,37.52836c-1.76506,2.19094 -3.26537,5.16471 -2.5425,9.48141c0.72386,6.89401 3.68894,10.48136 7.08016,12.39469c0.71632,3.91158 1.85343,7.83041 3.52242,11.10578c0.98847,1.93988 2.04883,3.68323 3.15164,5.16446c0.43962,0.59043 1.08687,0.97807 1.54492,1.49195c0.05605,4.58234 0.23554,8.19298 -0.30898,12.76547c-1.10749,2.83454 -3.79638,5.23948 -8.42203,7.60101c-4.74284,2.42137 -11.0162,4.59931 -17.40024,7.37149c-6.38403,2.77217 -12.95386,6.16261 -18.23008,11.49422c-4.33642,4.38195 -7.62559,10.18604 -8.98703,17.42672c-5.5801,-1.68039 -9.68445,-6.80296 -9.68445,-12.92437v-144.64c0,-7.47855 6.08145,-13.56 13.56,-13.56zM112.63805,54.24883c3.81442,0.00542 7.05634,0.57383 9.26953,1.44781c2.2238,0.87817 3.25619,1.92759 3.64602,2.78086l1.03289,2.27766l2.48953,0.32664c5.18467,0.67704 8.02005,2.62067 10.07289,5.41164c2.05284,2.79097 3.21306,6.73899 3.57539,11.20289c0.72466,8.92781 -1.87135,19.58323 -3.52242,24.33031l-1.14766,3.31055l2.91328,1.94219c-0.31889,-0.21221 1.10753,0.57495 0.8475,3.49594v0.00883c-0.71171,6.69369 -3.55917,6.40922 -1.99516,6.40922h-4.08742l-0.41492,4.06094c-0.33335,3.31487 -1.59706,7.18049 -3.07219,10.20531c-1.47512,3.02483 -3.90308,5.32866 -3.19578,4.92609l-2.28648,1.29774v2.63078c0,5.25676 -0.00176,9.86299 0.41492,16.07601l0.05297,0.68859l0.24719,0.64445c2.34691,6.04545 7.59829,9.68308 13.20687,12.47414c5.60858,2.79106 11.93567,4.91904 17.8593,7.47742c5.92363,2.55838 11.36882,5.51436 15.29031,9.49906c3.02767,3.07647 5.25822,6.71291 6.32977,11.70609h-134.31992c1.07891,-4.98293 3.32256,-8.61388 6.37391,-11.69727c3.95405,-3.99556 9.43898,-6.974 15.39625,-9.56086c5.95727,-2.58685 12.30727,-4.75715 17.91227,-7.61867c5.60499,-2.86152 10.83585,-6.63218 13.03914,-12.80078l0.15891,-0.45023l0.0618,-0.47672c0.87515,-6.52474 0.45023,-10.92023 0.45023,-16.36734v-2.63078l-2.28648,-1.29774c0.38384,0.21809 -0.38131,-0.32191 -1.09469,-1.28008c-0.71338,-0.95816 -1.55926,-2.3271 -2.34828,-3.87555c-1.57804,-3.09688 -2.9208,-6.97952 -3.23992,-9.99344l-0.42375,-4.04328h-3.8932c-0.28297,-0.11742 -1.65434,-1.02604 -2.17172,-6.42687l-0.01766,-0.19422l-0.03531,-0.18539c-0.47383,-2.59027 0.8322,-3.06809 0.89164,-3.1075l2.69258,-1.78328l-0.82101,-3.13398c-3.52184,-13.43871 -4.0129,-25.68206 -0.38844,-33.87352c3.61901,-8.17912 10.82182,-13.4413 26.53734,-13.83367z"
                      />
                    </g>
                  </g>
                </svg>
              </router-link>
            </template>
            <router-link to="/dashboard" v-if="auth">Profil</router-link>
            <router-link to="/logout" v-if="auth">Logout</router-link>
            <router-link to="/login" v-if="!auth">Login</router-link>
            <router-link to="/register" v-if="!auth">Register</router-link>
          </Accordion>
          <router-link to="/admin/users" v-if="isAdmin">Admin</router-link>
        </nav>
      </div>
    </header>
    <main>
      <router-view :userId=user._id />
    </main>
    <div
      class="msg-wrap"
      :class="[{active: notification.msg},{success: notification.status == 'success'}, {error: notification.status == 'error'}]"
    >
      <div class="inner">{{notification.msg}}</div>
    </div>
    <footer>
      <div class="container">
        <h5>
          &copy; {{new Date().getFullYear()}} mevn auth 24
          <span class="dash">|</span>
        </h5>
        <a href="https://www.gl-webentwicklung.de" target="_blank">
          <h5>glweb.de</h5>
        </a>
        <span class="last">
          view on
          <a href="https://github.com/gab2405/glweb-mevnauth" target="_blank">Github</a>
        </span>
      </div>
    </footer>
  </div>
</template>

<script>
import { mapState, mapGetters, mapMutations } from "vuex";
import Accordion from "@/components/Accordion";
const { getSecret } = require("@/globalFunctions");
export default {
  name: "App",
  components: { Accordion },
  data() {
    return {
      isAdmin: false,
      disabled: true
    };
  },
  computed: {
    ...mapState(["auth", "notification"]),
    ...mapGetters({
      userFromStore: "user"
    }),
    user: {
      get() {
        return this.userFromStore;
      },
      set(newUser) {
        return newUser;
      }
    }
  },
  methods: {
    ...mapMutations(["getAuth", "getUser", "setNotification"]),
    async checkUser() {
      if (localStorage.token) {
        this.getAuth(true);
        let response = await getSecret();
        this.getUser(response);
        if (response.userGroup == "Admin") {
          this.isAdmin = true;
        }
        if (response) {
          return false;
        }
      } else {
        this.getAuth(false);
        return false;
      }
    }
  },
  mounted() {
    this.checkUser();
  },
  watch: {
    auth(newValue) {
      if (newValue) {
        let el = this;
        if (el.checkUser()) {
          return true;
        } else {
          setTimeout(function() {
            if (el.checkUser()) {
              return true;
            }
            return false;
          }, 200);
        }
      } else {
        this.user = {};
        this.isAdmin = false;
      }
    }
  }
};
</script>